!function(){"use strict";function t(t,e){var r=[];if(t)return t.forEach(function(t){~r.indexOf(t[e])||r.push(t[e])}),r.map(function(t){return{text:t,value:t}})}angular.module("dataGrid",[]).filter("startFrom",function(){return function(t,e){return t?(e=+e,t.slice(e)):[]}}).controller("gridController",["$scope","$element","$filter","$location","filtersFactory","$timeout",function(e,r,i,n,o,a){function s(t){var r={},i=!1;r.page=e.paginationOptions.currentPage,e.paginationOptions.itemsPerPage!==e.defaultsPaginationOptions.itemsPerPage&&(r.itemsPerPage=e.paginationOptions.itemsPerPage),e.sortOptions.predicate&&(r.sort=encodeURIComponent(e.sortOptions.predicate+"-"+e.sortOptions.direction)),e.filters.forEach(function(t){var n=t.model,o=t.isInScope?e.$eval(n):e.$parent.$eval(n);if(t.disableUrl)return void(i=!0);if(o){var a;if(o instanceof Date){if(isNaN(o.getTime()))return;a=o.getFullYear()+"-",a+=o.getMonth()<9?"0"+(o.getMonth()+1)+"-":o.getMonth()+1+"-",a+=o.getDate()<10?"0"+o.getDate():o.getDate(),o=a}r[encodeURIComponent(n)]=encodeURIComponent(o)}}),i&&p(),n.search(r),t&&e.$apply()}function c(){var t=$.param(n.search()),r={},i={};if(e.params=r,t.split("&").forEach(function(t){var e=t.split("=");r[e[0]]=e[1],"page"!==e[0]&&"sort"!==e[0]&&"itemsPerPage"!==e[0]&&(i[decodeURIComponent(e[0])]=decodeURIComponent(e[1]))}),e.filters.forEach(function(t){var r=t.model,n=i[r];if(!t.disableUrl){if(~t.filterType.toLowerCase().indexOf("date"))return e.$parent.__evaltmp=n?new Date(n):null,void e.$parent.$eval(r+"=__evaltmp");"select"!==t.filterType||n||(n=""),n&&(t.isInScope?(e.__evaltmp=n,e.$eval(r+"=__evaltmp")):(e.$parent.__evaltmp=n,e.$parent.$eval(r+"=__evaltmp")))}}),e.paginationOptions.itemsPerPage=e.defaultsPaginationOptions.itemsPerPage,e.paginationOptions.currentPage=e.defaultsPaginationOptions.currentPage,r.itemsPerPage&&(e.paginationOptions.itemsPerPage=r.itemsPerPage),r.page&&(!e.serverPagination&&(r.page-1)*e.paginationOptions.itemsPerPage>e.gridRecords.length?e.paginationOptions.currentPage=1:e.paginationOptions.currentPage=r.page),r.sort){var o=r.sort.split("-");e.sortOptions.predicate=decodeURIComponent(o[0]),e.sortOptions.direction=decodeURIComponent(o[1])}e.serverPagination||p()}function l(){var t=n.search(),r=!Object.keys(t).length;r&&e.sortOptions.predicate?e.sort(e.sortOptions.predicate,!0):(e.$parent.params=t,e.getRecords(t).then(function(t){e.gridRecords=t.records,e.paginationOptions.totalItems=t.totalCount}))}function p(){var t=Date.now(),r=!1;e._time={},e.sortOptions.predicate&&e.sortCache&&e.sortCache.predicate===e.sortOptions.predicate&&e.sortCache.direction===e.sortOptions.direction&&(e.gridRecords=e.sortCache.data.slice(),r=!0),e._time.copy=Date.now()-t;var n=Date.now();d(),e._time.filters=Date.now()-n;var o=Date.now();e.sortOptions.predicate&&!r&&(e.gridRecords=i("orderBy")(e.gridRecords,e.sortOptions.predicate,"desc"===e.sortOptions.direction),e.sortCache={data:e.gridRecords.slice(),predicate:e.sortOptions.predicate,direction:e.sortOptions.direction}),e._time.sort=Date.now()-o,e._time.all=Date.now()-t,e.paginationOptions.totalItems=e.gridRecords.length}function d(){e.filters.forEach(function(t){var r=t.filterBy,i=t.model,n=t.isInScope?e.$eval(i):e.$parent.$eval(i),a=t.filterType;if(e.customFilters[i])e.gridRecords=e.customFilters[i](e.gridRecords,n,r);else if(n&&a){var s=o.getFilterByType(a);s&&(e.gridRecords=s(e.gridRecords,n,r))}})}e._gridActions=e.gridActions||{},e.paginationOptions={},e.defaultsPaginationOptions={itemsPerPage:e.paginationOptions.itemsPerPage||"10",currentPage:e.paginationOptions.currentPage||1},e.paginationOptions=angular.copy(e.defaultsPaginationOptions),e.sortOptions={},e.customFilters={},a(c),e.$watch("gridRecords",function(r){r&&r.length&&(e.sortCache={},e.filters.forEach(function(r){"select"===r.filterType&&(e[r.model+"Options"]=t(e.gridRecords,r.filterBy))}),e.urlSync&&c())}),e.sort=e.$parent.sort=function(t,r){if(!r){var i=e.sortOptions.predicate===t&&"desc"===e.sortOptions.direction?"asc":"desc";e.sortOptions.direction=i,e.sortOptions.predicate=t}e.paginationOptions.currentPage=1,e.reloadGrid(r)},e.filter=e.$parent.filter=function(){e.paginationOptions.currentPage=1,e.reloadGrid()},e.$on("$locationChangeSuccess",function(){(e.urlSync||e.serverPagination)&&(e.serverPagination&&(clearTimeout(e.getDataTimeout),e.getDataTimeout=setTimeout(l,e.getDataDelay)),e.gridRecords&&c())}),e.reloadGrid=function(t){e.urlSync||e.serverPagination?s(t):p()},e._gridActions.refresh=e.reloadGrid,e.$parent.reloadGrid=e.reloadGrid,e._gridActions.filter=e.filter,e._gridActions.sort=e.sort}]).directive("gridData",["$compile","$animate",function(e){return{restrict:"EA",scope:{serverPagination:"=?",gridData:"=?",gridRecords:"=?",getRecords:"&",gridActions:"=?",getDataDelay:"=?",sortOptions:"=?",paginationOptions:"=?",count:"=?"},controller:"gridController",link:function(r,i,n){var o=[],a=[],s=[],c=i.parent(),l=n.id,p="true"===n.serverPagination;r.getDataDelay=r.getDataDelay||350,angular.forEach(angular.element(c[0].querySelectorAll("[sortable]")),function(t){var i=angular.element(t),n=i.attr("sortable");o.push(i),i.attr("ng-class","{'sort-ascent' : sortOptions.predicate ==='"+n+"' && sortOptions.direction === 'asc', 'sort-descent' : sortOptions.predicate === '"+n+"' && sortOptions.direction === 'desc'}"),i.attr("ng-click","sort('"+n+"')"),e(i)(r)}),angular.forEach(angular.element(document.querySelectorAll("[filter-by]")),function(e){var n=angular.element(e),o=i.find(n).length>0,s=n.attr("filter-by"),c=n.attr("filter-type")||"",p=n.attr("ng-model"),d=n.attr("disable-url");l&&n.attr("grid-id")&&l!=n.attr("grid-id")||("select"!==c||(r[p+"Options"]=t(r.$eval(i.attr("grid-options")+".data"),s)),!~c.indexOf("date")||n.attr("ng-focus")||n.attr("ng-blur")||(n.attr("ng-focus","filter('{"+p+" : this."+p+"}')"),n.attr("ng-blur","filter('{"+p+" : this."+p+"}')")),p||(p=s,n.attr("ng-model",s),n.attr("ng-change","filter()")),a.push({model:p,isInScope:o,filterBy:s,filterType:c,disableUrl:d}))}),angular.forEach(angular.element(c[0].querySelectorAll("[grid-item]")),function(t){var i=angular.element(t);s.push(i),p?i.attr("ng-repeat","item in filtered"):i.attr("ng-repeat","item in filtered | startFrom:(paginationOptions.currentPage-1)*paginationOptions.itemsPerPage | limitTo:paginationOptions.itemsPerPage track by $index"),e(i)(r)}),r.sorting=o,r.rows=s,r.filters=a}}}]).factory("filtersFactory",function(){function t(t,e,r){return t.filter(function(t){return!e||!t[r]||t[r]===e})}function e(t,e,r){return t.filter(function(t){return e&&t[r]?~(t[r]+"").toLowerCase().indexOf((e+"").toLowerCase()):!!t[r]})}function r(t,e,r){return e=new Date(e).getTime(),t.filter(function(t){return!e||!t[r]||t[r]<=e+86399999})}function i(t,e,r){return e=new Date(e).getTime(),t.filter(function(t){return!e||!t[r]||t[r]>=e})}return{getFilterByType:function(n){switch(n){case"select":return t;case"text":return e;case"dateTo":return r;case"dateFrom":return i;default:return null}}}})}();